// TrackSettingsDialog - Per-track configuration popup.
// Clean compact layout matching Qt original.

import { VerticalBox, HorizontalBox, Button, GroupBox, ComboBox, LineEdit, CheckBox, SpinBox } from "std-widgets.slint";

// Language option
export struct LanguageOption {
    code: string,
    display: string,
}

export component TrackSettingsDialog inherits Window {
    title: "Track Settings";
    min-width: 400px;
    min-height: 300px;

    // Track info
    in property <string> track-type: "subtitles";
    in property <string> codec-id: "";

    // Language
    in-out property <[string]> language-display-names: [];
    in-out property <int> selected-language-index: 0;

    // Custom name
    in-out property <string> custom-name: "";

    // Subtitle options
    in-out property <bool> perform-ocr: false;
    in-out property <bool> convert-to-ass: false;
    in-out property <bool> rescale: false;
    in-out property <int> size-multiplier-pct: 100;

    // Visibility
    property <bool> is-subtitles: track-type == "subtitles";
    property <bool> is-image-based: codec-id == "S_HDMV/PGS" || codec-id == "S_VOBSUB";
    property <bool> is-srt: codec-id == "S_TEXT/UTF8";
    property <bool> is-ass: codec-id == "S_TEXT/ASS" || codec-id == "S_TEXT/SSA";

    callback configure-sync-exclusion();
    callback accept();
    callback cancel();

    out property <bool> accepted: false;

    VerticalBox {
        padding: 8px;
        spacing: 6px;

        // Language section
        GroupBox {
            title: "Language Settings";

            HorizontalBox {
                padding: 6px;
                spacing: 6px;

                Text {
                    text: "Language:";
                    vertical-alignment: center;
                    min-width: 90px;
                }

                ComboBox {
                    horizontal-stretch: 1;
                    model: language-display-names;
                    current-index <=> selected-language-index;
                }
            }
        }

        // Track name section
        GroupBox {
            title: "Track Name";

            HorizontalBox {
                padding: 6px;
                spacing: 6px;

                Text {
                    text: "Custom Name:";
                    vertical-alignment: center;
                    min-width: 90px;
                }

                LineEdit {
                    horizontal-stretch: 1;
                    text <=> custom-name;
                    placeholder-text: "Leave empty for default";
                }
            }
        }

        // Subtitle options
        if root.is-subtitles: GroupBox {
            title: "Subtitle Options";

            VerticalBox {
                padding: 6px;
                spacing: 4px;

                if root.is-image-based: CheckBox {
                    text: "Perform OCR (convert images to text)";
                    checked <=> perform-ocr;
                }

                if root.is-srt: CheckBox {
                    text: "Convert to ASS format";
                    checked <=> convert-to-ass;
                }

                CheckBox {
                    text: "Rescale to video resolution";
                    checked <=> rescale;
                }

                HorizontalBox {
                    spacing: 6px;

                    Text {
                        text: "Size multiplier:";
                        vertical-alignment: center;
                        min-width: 90px;
                    }

                    SpinBox {
                        value <=> size-multiplier-pct;
                        minimum: 10;
                        maximum: 1000;
                        max-width: 80px;
                    }

                    Text {
                        text: "%";
                        vertical-alignment: center;
                    }

                    Rectangle { horizontal-stretch: 1; }
                }

                if root.is-ass: Button {
                    text: "Configure Frame Sync Exclusions...";
                    clicked => { root.configure-sync-exclusion(); }
                }
            }
        }

        Rectangle { vertical-stretch: 1; }

        // Dialog buttons
        HorizontalBox {
            alignment: end;
            spacing: 6px;

            Button {
                text: "Cancel";
                clicked => { root.cancel(); }
            }

            Button {
                text: "OK";
                clicked => {
                    root.accepted = true;
                    root.accept();
                }
            }
        }
    }
}
