// JobQueueDialog - Dialog for managing the job queue.
// Clean compact layout matching Qt original.

import { VerticalBox, HorizontalBox, Button, ScrollView } from "std-widgets.slint";

// Job data
export struct JobRowData {
    id: string,
    name: string,
    source1: string,
    source2: string,
    source3: string,
    source4: string,
    status: string,
    is-selected: bool,
}

// Table row
component JobRow inherits Rectangle {
    in property <JobRowData> data;
    in property <int> row-index;
    in-out property <bool> is-selected: false;

    callback clicked();
    callback double-clicked();

    height: 28px;
    background: is-selected ? #3d5a80 : (touch.has-hover ? #3a3a3a : transparent);

    touch := TouchArea {
        clicked => { root.clicked(); }
        double-clicked => { root.double-clicked(); }
    }

    HorizontalBox {
        padding-left: 8px;
        padding-right: 8px;
        spacing: 4px;

        // Row number
        Text {
            text: row-index + 1;
            width: 30px;
            color: is-selected ? #ffffff : #888888;
            vertical-alignment: center;
            horizontal-alignment: center;
        }

        // Job name
        Text {
            text: data.name;
            min-width: 150px;
            font-weight: 500;
            vertical-alignment: center;
            overflow: elide;
        }

        // Source 1
        Text {
            text: data.source1;
            color: is-selected ? #ffffff : #aaaaaa;
            horizontal-stretch: 1;
            vertical-alignment: center;
            overflow: elide;
        }

        // Source 2
        Text {
            text: data.source2;
            color: is-selected ? #ffffff : #aaaaaa;
            horizontal-stretch: 1;
            vertical-alignment: center;
            overflow: elide;
        }

        // Source 3
        Text {
            text: data.source3 == "" ? "-" : data.source3;
            color: is-selected ? #ffffff : #666666;
            min-width: 120px;
            vertical-alignment: center;
            overflow: elide;
        }

        // Status
        Rectangle {
            width: 80px;
            height: 20px;
            border-radius: 3px;
            background: data.status == "Configured" ? #2d5a2d :
                        data.status == "Processing" ? #5a5a2d :
                        data.status == "Complete" ? #2d5a5a :
                        data.status == "Error" ? #5a2d2d : #333333;

            Text {
                text: data.status;
                font-size: 11px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }
    }
}

export component JobQueueDialog inherits Window {
    title: "Job Queue";
    min-width: 1000px;
    min-height: 500px;

    in-out property <[JobRowData]> jobs: [];
    in-out property <[int]> selected-indices: [];
    in-out property <bool> has-clipboard: false;
    in-out property <bool> is-processing: false;
    in-out property <string> status-message: "";

    callback add-jobs();
    callback remove-selected();
    callback move-up();
    callback move-down();
    callback configure-job(int);
    callback copy-layout(int);
    callback paste-layout();
    callback row-selected(int, bool);
    callback row-double-clicked(int);
    callback start-processing();
    callback cancel();
    callback files-dropped([string]);

    DropArea {
        width: 100%;
        height: 100%;

        dropped(event) => {
            if (event.mime-type == "text/uri-list") {
                root.files-dropped([event.data]);
            }
        }

        VerticalBox {
            padding: 8px;
            spacing: 6px;

            // Status message
            if status-message != "": Text {
                text: status-message;
                color: #5599dd;
                font-size: 12px;
            }

            // Table header
            Rectangle {
                background: #2a2a2a;
                height: 28px;
                border-radius: 3px;

                HorizontalBox {
                    padding-left: 8px;
                    padding-right: 8px;
                    spacing: 4px;

                    Text { text: "#"; width: 30px; font-weight: 600; color: #888888; vertical-alignment: center; horizontal-alignment: center; }
                    Text { text: "Job Name"; min-width: 150px; font-weight: 600; color: #888888; vertical-alignment: center; }
                    Text { text: "Source 1 (Reference)"; font-weight: 600; color: #888888; horizontal-stretch: 1; vertical-alignment: center; }
                    Text { text: "Source 2"; font-weight: 600; color: #888888; horizontal-stretch: 1; vertical-alignment: center; }
                    Text { text: "Source 3"; font-weight: 600; color: #888888; min-width: 120px; vertical-alignment: center; }
                    Text { text: "Status"; font-weight: 600; color: #888888; width: 80px; vertical-alignment: center; horizontal-alignment: center; }
                }
            }

            // Table body
            Rectangle {
                vertical-stretch: 1;
                background: #1e1e1e;
                border-radius: 3px;

                ScrollView {
                    VerticalBox {
                        spacing: 1px;
                        padding: 2px;

                        for job[idx] in jobs: JobRow {
                            data: job;
                            row-index: idx;
                            is-selected: job.is-selected;
                            clicked => { root.row-selected(idx, !job.is-selected); }
                            double-clicked => { root.row-double-clicked(idx); }
                        }

                        // Empty state
                        if jobs.length == 0: Rectangle {
                            min-height: 150px;

                            VerticalBox {
                                alignment: center;

                                Text {
                                    text: "No jobs in queue";
                                    font-size: 14px;
                                    color: #666666;
                                    horizontal-alignment: center;
                                }

                                Text {
                                    text: "Click 'Add Job(s)...' or drop files here";
                                    font-size: 12px;
                                    color: #555555;
                                    horizontal-alignment: center;
                                }
                            }
                        }
                    }
                }
            }

            // Action buttons
            HorizontalBox {
                spacing: 6px;

                Button {
                    text: "Add Job(s)...";
                    enabled: !is-processing;
                    clicked => { root.add-jobs(); }
                }

                Rectangle { horizontal-stretch: 1; }

                Button {
                    text: "Move Up";
                    enabled: !is-processing && selected-indices.length > 0;
                    clicked => { root.move-up(); }
                }

                Button {
                    text: "Move Down";
                    enabled: !is-processing && selected-indices.length > 0;
                    clicked => { root.move-down(); }
                }

                Button {
                    text: "Remove Selected";
                    enabled: !is-processing && selected-indices.length > 0;
                    clicked => { root.remove-selected(); }
                }
            }

            // Dialog buttons
            HorizontalBox {
                alignment: end;
                spacing: 6px;

                Button {
                    text: "Cancel";
                    enabled: !is-processing;
                    clicked => { root.cancel(); }
                }

                Button {
                    text: is-processing ? "Processing..." : "Start Processing Queue";
                    enabled: !is-processing && jobs.length > 0;
                    clicked => { root.start-processing(); }
                }
            }
        }
    }
}
