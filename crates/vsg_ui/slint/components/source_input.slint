// Reusable source input component with drag-and-drop support
// Uses experimental DropArea to receive files from OS file managers
import { Button, LineEdit } from "std-widgets.slint";

export component SourceInput inherits Rectangle {
    in property <string> label: "Source:";
    in-out property <string> path: "";
    in property <string> placeholder: "Drop file here or browse...";

    callback browse-clicked();
    callback path-changed(string);

    min-height: 32px;

    // DropArea covers the entire component to receive file drops
    DropArea {
        width: 100%;
        height: 100%;

        dropped(event) => {
            // Files from OS file managers come as "text/uri-list"
            if (event.mime-type == "text/uri-list") {
                // Pass the raw URI to backend for cleanup (file:// prefix, %20 decoding)
                root.path-changed(event.data);
            }
        }

        HorizontalLayout {
            spacing: 6px;

            Text {
                text: root.label;
                vertical-alignment: center;
                min-width: 110px;
            }

            LineEdit {
                text <=> root.path;
                placeholder-text: root.placeholder;
                horizontal-stretch: 1;

                edited => {
                    root.path-changed(root.path);
                }
            }

            Button {
                text: "Browse...";
                clicked => { root.browse-clicked(); }
            }
        }
    }
}
