// TrackWidget - Track display components.
// Compact two-row layout matching Qt's TrackWidget.

import { HorizontalBox, VerticalBox, CheckBox, ComboBox, Button } from "std-widgets.slint";

// Track data structure
export struct TrackWidgetData {
    id: int,
    source: string,
    track-type: string,
    codec-id: string,
    summary: string,
    badges: string,
    options-summary: string,
    is-default: bool,
    is-forced: bool,
    has-custom-name: bool,
    is-generated: bool,
    has-style-patch: bool,
    has-sync-exclusions: bool,
    sync-to-source: string,
}

// Full widget for final list - compact two-row layout like Qt
export component TrackWidget inherits Rectangle {
    in property <TrackWidgetData> data;
    in property <[string]> sync-source-options: [];

    property <bool> is-subtitles: data.track-type == "subtitles";
    property <bool> is-external: data.source == "External";
    property <bool> show-sync-dropdown: is-subtitles && is-external;
    property <bool> show-forced: is-subtitles;
    property <bool> show-style-editor: is-subtitles;

    callback default-changed(bool);
    callback forced-changed(bool);
    callback name-changed(bool);
    callback sync-source-changed(string);
    callback settings-clicked();
    callback style-editor-clicked();

    in-out property <bool> is-default: data.is-default;
    in-out property <bool> is-forced: data.is-forced;
    in-out property <bool> has-custom-name: data.has-custom-name;

    VerticalLayout {
        padding: 3px;
        spacing: 2px;

        // Top row: summary | badges | source
        HorizontalLayout {
            spacing: 6px;

            Text {
                text: data.summary;
                font-weight: 600;
                font-size: 12px;
                horizontal-stretch: 1;
                overflow: elide;
                vertical-alignment: center;
            }

            if data.badges != "": Text {
                text: data.badges;
                font-weight: 600;
                font-size: 11px;
                color: #ddaa55;
                vertical-alignment: center;
            }

            Text {
                text: data.source;
                font-size: 11px;
                color: #888888;
                vertical-alignment: center;
            }
        }

        // Bottom row: stretch | sync dropdown | checkboxes | buttons
        HorizontalLayout {
            spacing: 4px;

            // Stretch to push controls right
            Rectangle { horizontal-stretch: 1; }

            if root.show-sync-dropdown: HorizontalLayout {
                spacing: 3px;

                Text {
                    text: "Sync:";
                    font-size: 10px;
                    color: #888888;
                    vertical-alignment: center;
                }

                ComboBox {
                    model: sync-source-options;
                    current-value: data.sync-to-source;
                    min-width: 80px;
                    selected(val) => { root.sync-source-changed(val); }
                }
            }

            CheckBox {
                text: "Default";
                checked <=> root.is-default;
                toggled => { root.default-changed(root.is-default); }
            }

            if root.show-forced: CheckBox {
                text: "Forced";
                checked <=> root.is-forced;
                toggled => { root.forced-changed(root.is-forced); }
            }

            CheckBox {
                text: "Set Name";
                checked <=> root.has-custom-name;
                toggled => { root.name-changed(root.has-custom-name); }
            }

            if root.show-style-editor: Button {
                text: "Style Editor...";
                clicked => { root.style-editor-clicked(); }
            }

            Button {
                text: "Settings...";
                clicked => { root.settings-clicked(); }
            }
        }
    }
}

// Compact version for source lists
export component TrackListItem inherits Rectangle {
    in property <TrackWidgetData> data;
    in property <bool> is-blocked: false;

    callback double-clicked();
    callback context-menu-requested();

    min-height: 28px;
    background: touch.has-hover ? #3a3a3a : transparent;
    border-radius: 3px;
    opacity: is-blocked ? 0.5 : 1.0;

    touch := TouchArea {
        mouse-cursor: is-blocked ? not-allowed : pointer;

        double-clicked => {
            if (!root.is-blocked) { root.double-clicked(); }
        }

        pointer-event(event) => {
            if (event.button == PointerEventButton.right && event.kind == PointerEventKind.up) {
                root.context-menu-requested();
            }
        }
    }

    HorizontalBox {
        padding: 4px;
        spacing: 6px;

        // Track type indicator
        Rectangle {
            width: 3px;
            height: 100%;
            border-radius: 1px;
            background: data.track-type == "video" ? #8855dd :
                        data.track-type == "audio" ? #55aa55 : #ddaa55;
        }

        // Summary
        Text {
            text: data.summary;
            font-size: 12px;
            color: root.is-blocked ? #666666 : #f0f0f0;
            horizontal-stretch: 1;
            overflow: elide;
            vertical-alignment: center;
        }

        // Badges
        if data.badges != "": Text {
            text: data.badges;
            font-size: 10px;
            color: #ddaa55;
            vertical-alignment: center;
        }

        // Blocked indicator
        if root.is-blocked: Text {
            text: "(blocked)";
            font-size: 10px;
            color: #666666;
            vertical-alignment: center;
        }
    }
}
